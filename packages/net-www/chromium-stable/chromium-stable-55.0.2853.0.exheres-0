# Copyright 2009-2011 Elias Pipping <pipping@exherbo.org>
# Copyright 2009 Heiko Przybyl <zuxez@cs.tu-berlin.de>
# Distributed under the terms of the GNU General Public License v2

require chromium

DESCRIPTION+="
Chromium has three release channels: Stable, Beta, and Dev. This package corresponds to the Stable
channel.
"

PLATFORMS="~amd64 ~x86"

DEPENDENCIES+="
    build+run:
        !net-www/chromium-beta
        !net-www/chromium-dev
        !net-www/chromium-stable-pdf-plugin [[
            description = [ Chromium now provides libpdf ]
            resolution = uninstall-blocked-before
        ]]
    suggestion:
        net-www/chromium-stable-flash-plugin [[ description = [ Adobe Flash Player plugin for Chromium ] ]]
        net-www/chromium-stable-widevine-plugin [[ description = [ Content Decryption Module plugin required for e.g. Netflix ] ]]
"

RESTRICT=test

# http://dl.google.com/linux/chrome/deb/pool/main/g/google-chrome-stable/google-chrome-stable_${PV}-1_amd64.deb
# $ ar -x google-chrome-stable_${PV}-1_amd64.deb
# $ tar xf data.tar.xz
# $ strings ./opt/google/chrome/chrome | grep -C 1 " (version:" | head -n 1
WIDEVINE_VERSION=1.4.8.893

src_prepare() {
    chromium_src_prepare

    edo sed \
        -e "14i#define WIDEVINE_CDM_VERSION_STRING \"${WIDEVINE_VERSION}\"" \
        -i "third_party/widevine/cdm/stub/widevine_cdm_version.h"
}

